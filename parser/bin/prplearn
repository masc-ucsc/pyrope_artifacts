#!/bin/bash

SCRIPT=`realpath $0`
export PRP_PATH=`dirname $SCRIPT`"/.."
dir="$(pwd)"
#cmd_var="${1:?missing operand}"
if [ $# -eq 0 ]
then
  echo "prplearn: missing operand"
  echo "Try prplearn --help for more information"
  exit 0
fi

if [ $1 == 'clean' ]
then
  rm $HOME/.prp/parser/data/prplearn.json
elif [ $1 == 'add' ]
then
  if [ -z "$2" ]
  then
    echo "ERROR: prplearn add needs valid input file(s) as command line argument"
    exit 0
  fi
  for x in $@; do
    if [ $x != 'add' ]
    then
      $PRP_PATH/bin/prplearn0 $x
      $PRP_PATH/bin/prplearn1 $x
      $PRP_PATH/bin/prplearn2 $x
      $PRP_PATH/bin/prplearn3
      #echo $x
    fi
  done
elif [ $1 == 'rm' ]
then
  #echo $1
  if [ -z "$2" ]
  then
    echo "ERROR: prplearn rm needs valid input file(s) as command line argument"
    exit 0
  fi
  for x in $@; do
    if [ $x != 'rm' ]
    then
      $PRP_PATH/bin/prplearn0 $x
      $PRP_PATH/bin/prplearn1 $x
      $PRP_PATH/bin/prplearn2 $x
      $PRP_PATH/bin/prplearn3 $1
      #echo $1
    fi
  done
elif [ $1 == 'publish' ]
then
  $PRP_PATH/bin/prplearn3 $1
elif [ $1 == '--help' ]
then
  echo "Usage: prplearn [OPTION]"
  echo "PRP learns new user defined error messagges"
  printf "\n"
  echo "Options:"
  echo "========"
  echo "add [FILE(s)..]       add new user defined error message to prp from one or more files"
  echo "clean                 deletes the local user prplearn.json"
  echo "rm [FILE(s)..]        remove error messages associated with file(s) from local user prplear.json"
  echo "publish               combines system-level and user-level prplearn.json"
fi
